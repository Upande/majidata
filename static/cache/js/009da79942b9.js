Heron.globals.imagePath='/static/js/lib/heron/0.75/resources/images/';var mapH;if(document.body&&document.body.offsetWidth){var winH=document.body.offsetHeight;if(winH>500){mapH=winH-(0.2*winH);}else{mapH=500;}}
var classes=[["county",[["Nareas",[['4','14','#fef0d9'],['14','31','#fdcc8a'],['31','63','#fc8d59'],['63','116','#e34a33'],['116','386','#b30000']]],["Pop",[['8024','39225','#fef0d9'],['39225','110548','#fdcc8a'],['110548','192751','#fc8d59'],['192751','1321813','#e34a33'],['1321813','2925942','#b30000']]],["AvgHHSz",[['2.5000','3.4000','#fef0d9'],['3.4000','4.3000','#fdcc8a'],['4.3000','5.3000','#fc8d59'],['5.3000','7.1000','#e34a33'],['7.1000','9','#b30000']]],["PopUnplAre",[['0','6843','#fef0d9'],['6843','10067','#fdcc8a'],['10067','14230','#fc8d59'],['14230','60235','#e34a33'],['60235','1412467','#b30000']]],["NareasLink",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["NareasRegF",[['0','5','#fef0d9'],['5','10','#fdcc8a'],['10','15','#fc8d59'],['15','20','#e34a33'],['20','30','#b30000']]],["PlotsConne",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["DUsConnect",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["SafeWaterP",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["PipedWater",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["MnSrcPcnt",[['Piped water'],['Vendors'],['Spring'],['Yard well'],['Stream']]],["PayingforW",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["ImpSanPop",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]]]],["town",[["Nareas",[['1','3','#fef0d9'],['3','8','#fdcc8a'],['8','17','#fc8d59'],['17','41','#e34a33'],['41','386','#b30000']]],["Pop",[['411','22686','#fef0d9'],['22686','70904','#fdcc8a'],['70904','171275','#fc8d59'],['171275','1321813','#e34a33'],['1321813','2925942','#b30000']]],["AvgHHSz",[['2.3000','3.4000','#fef0d9'],['3.4000','4.3000','#fdcc8a'],['4.3000','5.6000','#fc8d59'],['5.6000','7.4000','#e34a33'],['7.4000','9','#b30000']]],["PopUnplAre",[['0','6843','#fef0d9'],['6843','10067','#fdcc8a'],['10067','14230','#fc8d59'],['14230','60235','#e34a33'],['60235','1412467','#b30000']]],["NareasLink",[['0','4','#fef0d9'],['4','14','#fdcc8a'],['14','33','#fc8d59'],['33','298','#e34a33'],['298','357','#b30000']]],["NareasRegF",[['0','5','#fef0d9'],['5','10','#fdcc8a'],['10','15','#fc8d59'],['15','20','#e34a33'],['20','30','#b30000']]],["PlotsConne",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["DUsConnect",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["SafeWaterP",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["PipedWater",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["MnSrcPcnt",[['Piped water'],['Vendors'],['Spring'],['Yard well'],['Stream']]],["PayingforW",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["ImpSanPop",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]]]],["slum",[["Nareas",[['#fef0d9'],['#fdcc8a'],['#fc8d59'],['#e34a33'],['#b30000']]],["Pop",[['#fef0d9'],['#fdcc8a'],['#fc8d59'],['#e34a33'],['#b30000']]],["AvgHHSz",[['#fef0d9'],['#fdcc8a'],['#fc8d59'],['#e34a33'],['#b30000']]],["PopUnplAre",[['0','300','#fef0d9'],['300','1000','#fdcc8a'],['1000','10000','#fc8d59'],['10000','100000','#e34a33'],['100000','250000','#b30000']]],["NareasLink",[['0','4','#fef0d9'],['4','14','#fdcc8a'],['14','33','#fc8d59'],['33','298','#e34a33'],['298','357','#b30000']]],["NareasRegF",[['0','5','#fef0d9'],['5','10','#fdcc8a'],['10','15','#fc8d59'],['15','20','#e34a33'],['20','30','#b30000']]],["PlotsConne",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["DUsConnect",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["SafeWaterP",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["PipedWater",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["MnSrcPcnt",[['Piped water'],['Vendors'],['Spring'],['Yard well'],['Stream']]],["PayingforW",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["ImpSanPop",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]]]],["wsp",[["Nareas",[['4','14','#fef0d9'],['14','31','#fdcc8a'],['31','63','#fc8d59'],['63','116','#e34a33'],['116','386','#b30000']]],["Pop",[['8024','39225','#fef0d9'],['39225','110548','#fdcc8a'],['110548','192751','#fc8d59'],['192751','1321813','#e34a33'],['1321813','2925942','#b30000']]],["AvgHHSz",[['2.5000','3.4000','#fef0d9'],['3.4000','4.3000','#fdcc8a'],['4.3000','5.3000','#fc8d59'],['5.3000','7.1000','#e34a33'],['7.1000','9','#b30000']]],["PopUnplAre",[['0','300','#fef0d9'],['300','1000','#fdcc8a'],['1000','10000','#fc8d59'],['10000','100000','#e34a33'],['100000','250000','#b30000']]],["NareasLink",[['0','4','#fef0d9'],['4','14','#fdcc8a'],['14','33','#fc8d59'],['33','298','#e34a33'],['298','357','#b30000']]],["NareasRegF",[['0','5','#fef0d9'],['5','10','#fdcc8a'],['10','15','#fc8d59'],['15','20','#e34a33'],['20','30','#b30000']]],["PlotsConne",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["DUsConnect",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["SafeWaterP",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["PipedWater",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["MnSrcPcnt",[['Piped water'],['Vendors'],['Spring'],['Yard well'],['Stream']]],["PayingforW",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["ImpSanPop",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]]]],["area",[["AreaPop",[['139','3644','#fef0d9'],['3644','8012','#fdcc8a'],['8012','15177','#fc8d59'],['15177','29636','#e34a33'],['29636','59731','#b30000']]],["PopDensity",[['276','33407','#fef0d9'],['33407','82167','#fdcc8a'],['82167','180433','#fc8d59'],['180433','357847','#e34a33'],['357847','710400','#b30000']]],["AreaType",[['Unplanned'],['Planned']]],["WSPName",[['Garissa Water and Sewerage Company'],['Kilifi-Mariakani Water and Sanitation'],['Kwale Water and Sewerage Company'],['Malindi Water and Sewerage Company'],['Mombasa Water and Sewerage Company'],['Nairobi City Water and Sewerage Company'],['Tavevo Water and Sewerage Company']]],["Legalised",[['Being legalised'],['Illegal'],['Legal'],['Partly Legalised']]],["Legalised",[['Being legalised'],['Illegal'],['Legal'],['Partly Legalised']]],["OverallRan",[['Poor'],['Fair'],['Good']]],["TotScore",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["SqKm",[['0','0.05','#fef0d9'],['0.05','0.10','#fdcc8a'],['0.10','0.50','#fc8d59'],['0.50','1','#e34a33'],['1','10','#b30000']]],["PcntPPleRe",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["AreaSmpPop",[['0','100','#fef0d9'],['100','150','#fdcc8a'],['150','250','#fc8d59'],['250','400','#e34a33'],['400','800','#b30000']]],["AreaSmpDUs",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["TotHHs",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','150','#b30000']]],["AvgDUSz",[['0','2','#fef0d9'],['2','4','#fdcc8a'],['4','6','#fc8d59'],['6','8','#e34a33'],['8','15','#b30000']]],["AvgHHSz",[['0','2','#fef0d9'],['2','4','#fdcc8a'],['4','6','#fc8d59'],['6','8','#e34a33'],['8','15','#b30000']]],["numDU",[['0','200','#fef0d9'],['200','400','#fdcc8a'],['400','600','#fc8d59'],['600','1000','#e34a33'],['1000','3000','#b30000']]],["ADist",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["AreaLinked",[['Yes'],['No']]],["CommunityS",[['Yes'],['No']]],["WsupplyPro",[['Yes'],['No']]],["NAdeqSuppl",[['0','200','#fef0d9'],['200','400','#fdcc8a'],['400','1600','#fc8d59'],['1600','8000','#e34a33'],['8000','10000','#b30000']]],["PcntPpleIm",[['0','20','#fef0d9'],['20','40','#fdcc8a'],['40','60','#fc8d59'],['60','80','#e34a33'],['80','100','#b30000']]],["PHSit",[['Poor'],['Fair'],['Good']]],["MainSFacil",[['No facilities'],['Private Facilities'],['Communal Facilities'],['Public Facilities']]]]]];var chart_indicators=[["higher",[["general",[['Nareas','Number of areas']]],["population",[['Pop','Population'],['AvgHHSz','Average household size'],['PopUnplAre','Unplanned Areas Population']]],["water",[['NareasLink','Connected to distribution network'],['NareasRegF','Number of Areas Regular Flow'],['PlotsConne','Plots Connected '],['DUsConnect','Dwellings Connected'],['SafeWaterP','Safe Water Percentage'],['PipedWater','Piped Water'],['MnSrcPcnt','Percentage of Main Source'],['PayingforW','Paying for Water']]],["sanitation",[['ImpSanPop','Improved Sanitation Population']]]]],["areas",[["general",[['AreaType','Type of area'],['Legalised','Legal Status of Area'],['OverallRan','Overal Ranking'],['TotScore','Total Score']]],["population",[['AreaPop','Population'],['PopDensity','Population density'],['SqKm','Square Kilometers'],['PcntPPleRe','Percentage Planned'],['AreaSmpPop','Area Sample Population'],['AreaSmpDUs','Area Sample Dwellings'],['TotHHs','Total Households'],['AvgDUSz','Average Dwelling Size'],['AvgHHSz','Average Household Size'],['numDU','Number of Dwellings'],['ADist','Distance to town centre']]],["water",[['AreaLinked','Connected to distribution network'],['CommunityS','Community Supply'],['WsupplyPro','Water Supply'],['NAdeqSuppl','Number Adequately Supplied']]],["sanitation",[['PcntPpleIm','Percentage People Improved'],['ImpSanPop','Improved Sanitation Population'],['PHSit','Public Healtth Situation'],['MainSFacil','Main Sanitation Facilitty']]]]]];var style_indicators=[["higher",[["general",[['Nareas','Number of areas']]],["population",[['Pop','Population'],['AvgHHSz','Average household size'],['PopUnplAre','Unplanned Areas Population']]],["water",[['NareasLink','Connected to distribution network'],['NareasRegF','Number of Areas Regular Flow'],['PlotsConne','Plots Connected '],['DUsConnect','Dwellings Connected'],['SafeWaterP','Safe Water Percentage'],['PipedWater','Piped Water'],['MnSrcPcnt','Percentage of Main Source'],['PayingforW','Paying for Water']]],["sanitation",[['ImpSanPop','Improved Sanitation Population']]]]],["areas",[["general",[['AreaType','Type of area'],['Legalised','Legal Status of Area'],['OverallRan','Overal Ranking'],['TotScore','Total Score']]],["population",[['AreaPop','Population'],['PopDensity','Population density'],['SqKm','Square Kilometers'],['PcntPPleRe','Percentage Planned'],['AreaSmpPop','Area Sample Population'],['AreaSmpDUs','Area Sample Dwellings'],['TotHHs','Total Households'],['AvgDUSz','Average Dwelling Size'],['AvgHHSz','Average Household Size'],['numDU','Number of Dwellings'],['ADist','Distance to town centre']]],["water",[['AreaLinked','Connected to distribution network'],['CommunityS','Community Supply'],['WsupplyPro','Water Supply'],['NAdeqSuppl','Number Adequately Supplied']]],["sanitation",[['PcntPpleIm','Percentage People Improved'],['ImpSanPop','Improved Sanitation Population'],['PHSit','Public Healtth Situation'],['MainSFacil','Main Sanitation Facilitty']]]]]];var layers_=[['county','Counties'],['town','Towns'],['slum','Slums'],['area','Areas'],['wsp','WSP']];var cats_=[['general','General Information'],['population','Population and Housing'],['water','Water Supply'],['sanitation','Sanitation and Public Health']];var fields_=[];var indicator_style_form=new Ext.FormPanel({labelWidth:60,padding:10,defaultType:'textfield',items:[new Ext.form.ComboBox({id:'cmblevels_',fieldLabel:'Level',store:new Ext.data.ArrayStore({fields:['field1','field2'],data:layers_}),valueField:'field1',displayField:'field2',typeAhead:false,mode:'local',triggerAction:'all',emptyText:'Select Level ...',selectOnFocus:false,width:150,listeners:{'select':function(valueField){Ext.getCmp('cmbcats_').clearValue();Ext.getCmp('cmbfields_').clearValue();Ext.getCmp('cmbfields_').getStore().removeAll();}}}),new Ext.form.ComboBox({id:'cmbcats_',fieldLabel:'Category',store:new Ext.data.ArrayStore({fields:['field1','field2'],data:cats_}),valueField:'field1',displayField:'field2',typeAhead:false,mode:'local',triggerAction:'all',emptyText:'Select Category ...',selectOnFocus:false,width:150,listeners:{'select':function(valueField){loadStyleIndicators(valueField.value);}}}),new Ext.form.ComboBox({id:'cmbfields_',fieldLabel:'Indicator',store:new Ext.data.ArrayStore({fields:['field1','field2'],data:fields_}),valueField:'field1',displayField:'field2',mode:'local',triggerAction:'all',emptyText:'Select Indicator ...',selectOnFocus:false,width:150,listeners:{'select':function(valueField){Ext.getCmp('styleLoading').setValue('Loading... Please wait.')
applyStyle();}}}),new Ext.form.TextArea({id:"styleLoading",readOnly:true,html:"Nothing Selected. To change Styles please select an option.",width:200,hideLabel:true,style:{"text-align":"center",height:'40px',color:"#3399FF",}}),new Ext.Button({text:'Reset Map',tooltip:'Click here to clear changes on the map',handler:function(){Heron.options.map.layers[4].mergeNewParams({sld_body:null});Heron.options.map.layers[5].mergeNewParams({sld_body:null});Heron.options.map.layers[6].mergeNewParams({sld_body:null});Heron.options.map.layers[7].mergeNewParams({sld_body:null});Heron.options.map.layers[8].mergeNewParams({sld_body:null});},}),],});var indicator_form=new Ext.FormPanel({labelWidth:60,height:200,padding:10,defaultType:'textfield',items:[new Ext.form.ComboBox({id:'cmblevels',fieldLabel:'Level',hiddenName:'myLevels',store:new Ext.data.ArrayStore({fields:['field1','field2'],data:layers_}),valueField:'field1',displayField:'field2',typeAhead:false,mode:'local',triggerAction:'all',emptyText:'Select Level ...',selectOnFocus:false,width:150,listeners:{'select':function(valueField){Ext.getCmp('cmbcats').clearValue();Ext.getCmp('cmbfields').clearValue();Ext.getCmp('cmbfields').getStore().removeAll();}}}),new Ext.form.ComboBox({id:'cmbcats',fieldLabel:'Category',hiddenName:'myCats_',store:new Ext.data.ArrayStore({fields:['field1','field2'],data:cats_}),valueField:'field1',displayField:'field2',typeAhead:false,mode:'local',triggerAction:'all',emptyText:'Select Category ...',selectOnFocus:false,width:150,listeners:{'select':function(valueField){loadChartIndicators(valueField.value);}}}),new Ext.form.ComboBox({id:'cmbfields',fieldLabel:'Indicator',store:new Ext.data.ArrayStore({fields:['field1','field2'],data:fields_}),valueField:'field1',displayField:'field2',mode:'local',triggerAction:'all',emptyText:'Select Indicator ...',selectOnFocus:false,width:150,listeners:{'select':function(valueField){Ext.getCmp('chartLoading').setValue('Loading... Please wait.')
applyChart();}}}),new Ext.form.TextArea({id:"chartLoading",readOnly:true,html:"Nothing Selected. To view chart please select an option.",width:200,hideLabel:true,style:{"text-align":"center",color:"#3399FF",}}),],});function applyChart(){var level_=Ext.getCmp('cmblevels').getValue();var field_=Ext.getCmp('cmbfields').getValue();var chart_=Ext.getCmp('majichart');if(level_=='county'){name='countyname';}else if(level_=='town'){name='townname';}else if(level_=='slum'){name='slumname';}else if(level_=='area'){name='areaname';}else if(level_=='wsp'){name='wspname';}
var url_='/api/v1/'+level_+'/?format=json';Ext.Ajax.request({url:url_,success:function(result,request){var jsonData=Ext.util.JSON.decode(result.responseText);var j_=[];for(var i=0;i<jsonData.objects.length;i++){var sr={name:jsonData.objects[i][name],value:jsonData.objects[i][field_.toLowerCase()]};j_.push(sr);}
chart_.store=genstore(j_);if(level_=='area'){chart_.setWidth('8000');}else if(level_=='town'){chart_.setWidth('2000');}else{chart_.setWidth('1100');}
chart_.refresh();Ext.getCmp('chartLoading').setValue('Done!')},failure:function(result,request){}})
function genstore(data_){var store=new Ext.data.JsonStore({fields:['name','value'],data:data_});return store;}}
var sld_1;var rul_;function applyStyle(){var level_=Ext.getCmp('cmblevels_').getValue();var field_=Ext.getCmp('cmbfields_').getValue();var sld="";for(var i=0;i<classes.length;i++){if(classes[i][0]==level_){var categories=classes[i][1];for(var j=0;j<categories.length;j++){if(categories[j][0]==field_){var classes_=categories[j][1];sld+='<?xml version="1.0" encoding="UTF-8"?><sld:StyledLayerDescriptor xmlns="http://www.opengis.net/sld" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:gml="http://www.opengis.net/gml" version="1.0.0">';sld+='<NamedLayer><Name>'+getLayerName(level_)+'</Name><UserStyle><Title>Default Style</Title><FeatureTypeStyle>';for(var k=0;k<classes_.length;k++){var rule='';if(!isNaN(classes_[k][0])){rule+='<Rule><Title>';rule+=parseInt(classes_[k][0])+'-'+parseInt(classes_[k][1]);rule+='</Title><ogc:Filter>';rule+='<ogc:PropertyIsBetween><ogc:PropertyName>';rule+=field_;rule+='</ogc:PropertyName><ogc:LowerBoundary><ogc:Literal>';rule+=parseInt(classes_[k][0]);rule+='</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>';rule+=parseInt(classes_[k][1]);rule+='</ogc:Literal></ogc:UpperBoundary></ogc:PropertyIsBetween>';rule+='</ogc:Filter>';rule+='<PolygonSymbolizer><Fill><CssParameter name="fill">';rule+=classes_[k][2];rule+='</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer>';rule+='</Rule>';}else{rule+='<Rule><Title>';rule+=classes_[k][0];rule+='</Title><ogc:Filter>';rule+='<ogc:PropertyIsLike wildCard="*" singleChar="." escape="!"><ogc:PropertyName>';rule+=field_;rule+='</ogc:PropertyName><ogc:Literal>';rule+=classes_[k][0];rule+='*</ogc:Literal></ogc:PropertyIsLike>';rule+='</ogc:Filter>';rule+='<PolygonSymbolizer><Fill><CssParameter name="fill">';rule+=get_random_color();rule+='</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer>';rule+='</Rule>';}
sld+=rule;rul_+=rule;}
sld+='</FeatureTypeStyle></UserStyle></NamedLayer></sld:StyledLayerDescriptor>';}}}}
sld_1=sld;if(level_=='county'){Heron.options.map.layers[4].mergeNewParams({STYLES:"",SLD_BODY:sld});}else if(level_=='town'){Heron.options.map.layers[5].mergeNewParams({STYLES:"",SLD_BODY:sld});}else if(level_=='slum'){Heron.options.map.layers[6].mergeNewParams({STYLES:"",SLD_BODY:sld});}else if(level_=='area'){Heron.options.map.layers[7].mergeNewParams({STYLES:"",SLD_BODY:sld});}else if(level_=='wsp'){Heron.options.map.layers[8].mergeNewParams({STYLES:"",SLD_BODY:sld});}
Ext.getCmp('styleLoading').setValue('Done!')}
function loadChartIndicators(category){var myAttributes=[];var attrib_combo=Ext.getCmp('cmbfields');var store=attrib_combo.getStore();attrib_combo.clearValue();store.removeAll();var level=Ext.getCmp('cmblevels').getValue();if(level=='area'){var categories=chart_indicators[1][1];for(var i=0;i<categories.length;i++){if(categories[i][0]==category){var indicators_=categories[i][1];for(var j=0;j<indicators_.length;j++){var field1=indicators_[j][0];var field2=indicators_[j][1];myAttributes.push([field1,field2]);}}}
store.loadData(myAttributes);}else{var categories=chart_indicators[0][1];for(var i=0;i<categories.length;i++){if(categories[i][0]==category){var indicators_=categories[i][1];for(var j=0;j<indicators_.length;j++){var field1=indicators_[j][0];var field2=indicators_[j][1];myAttributes.push([field1,field2]);}}}
store.loadData(myAttributes);}}
function getLayerName(level_){if(level_=='county'){name='geonode:majidata_counties';}else if(level_=='town'){name='geonode:majidata_towns';}else if(level_=='slum'){name='geonode:majidata_slums';}else if(level_=='area'){name='geonode:majidata_areas';}else if(level_=='wsp'){name='geonode:majidata_wsp';}
return name;}
function loadStyleIndicators(category){var myAttributes=[];var attrib_combo=Ext.getCmp('cmbfields_');var store=attrib_combo.getStore();attrib_combo.clearValue();store.removeAll();var level=Ext.getCmp('cmblevels_').getValue();if(level=='area'){var categories=style_indicators[1][1];for(var i=0;i<categories.length;i++){if(categories[i][0]==category){var indicators_=categories[i][1];for(var j=0;j<indicators_.length;j++){var field1=indicators_[j][0];var field2=indicators_[j][1];myAttributes.push([field1,field2]);}}}
store.loadData(myAttributes);}else{var categories=style_indicators[0][1];for(var i=0;i<categories.length;i++){if(categories[i][0]==category){var indicators_=categories[i][1];for(var j=0;j<indicators_.length;j++){var field1=indicators_[j][0];var field2=indicators_[j][1];myAttributes.push([field1,field2]);}}}
store.loadData(myAttributes);}}
function get_random_color(){var letters='0123456789ABCDEF'.split('');var color='#';for(var i=0;i<6;i++){color+=letters[Math.round(Math.random()*15)];}
return color;}
var dd='<sld:StyledLayerDescriptor xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0.0"><NamedLayer><Name>county</Name><UserStyle><Title>Default Style</Title><FeatureTypeStyle><Rule><Title>4-14</Title><ogc:Filter><ogc:PropertyIsBetween><ogc:PropertyName>Nareas</ogc:PropertyName><ogc:LowerBoundary><ogc:Literal>4</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>14</ogc:Literal></ogc:UpperBoundary></ogc:PropertyIsBetween></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#fef0d9</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer></Rule><Rule><Title>14-31</Title><ogc:Filter><ogc:PropertyIsBetween><ogc:PropertyName>Nareas</ogc:PropertyName><ogc:LowerBoundary><ogc:Literal>14</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>31</ogc:Literal></ogc:UpperBoundary></ogc:PropertyIsBetween></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#fdcc8a</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer></Rule><Rule><Title>31-63</Title><ogc:Filter><ogc:PropertyIsBetween><ogc:PropertyName>Nareas</ogc:PropertyName><ogc:LowerBoundary><ogc:Literal>31</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>63</ogc:Literal></ogc:UpperBoundary></ogc:PropertyIsBetween></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#fc8d59</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer></Rule><Rule><Title>63-116</Title><ogc:Filter><ogc:PropertyIsBetween><ogc:PropertyName>Nareas</ogc:PropertyName><ogc:LowerBoundary><ogc:Literal>63</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>116</ogc:Literal></ogc:UpperBoundary></ogc:PropertyIsBetween></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#e34a33</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer></Rule><Rule><Title>116-386</Title><ogc:Filter><ogc:PropertyIsBetween><ogc:PropertyName>Nareas</ogc:PropertyName><ogc:LowerBoundary><ogc:Literal>116</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>386</ogc:Literal></ogc:UpperBoundary></ogc:PropertyIsBetween></ogc:Filter><PolygonSymbolizer><Fill><CssParameter name="fill">#b30000</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer></Rule></FeatureTypeStyle></UserStyle></NamedLayer></sld:StyledLayerDescriptor>';OpenLayers.Util.onImageLoadErrorColor="transparent";OpenLayers.ProxyHost="/cgi-bin/proxy.cgi?url=";Ext.BLANK_IMAGE_URL='http://cdnjs.cloudflare.com/ajax/libs/extjs/3.4.1-1/resources/images/default/s.gif';Ext.namespace("Heron.examples");Heron.examples.searchPanelConfig={xtype:'hr_multisearchcenterpanel',height:600,hropts:[{searchPanel:{xtype:'hr_searchbydrawpanel',name:__('Search by Drawing'),header:false},resultPanel:{xtype:'hr_featuregridpanel',id:'hr-featuregridpanel',header:false,autoConfig:true,exportFormats:['XLS','WellKnownText'],hropts:{zoomOnRowDoubleClick:true,zoomOnFeatureSelect:false,zoomLevelPointSelect:8,zoomToDataExtent:false}}},{searchPanel:{xtype:'hr_searchbyfeaturepanel',name:__('Search by Feature Selection'),description:'Select feature-geometries from one layer and use these to perform a spatial search in another layer.',header:false,border:false,bodyStyle:'padding: 6px',style:{fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'12px'}},resultPanel:{xtype:'hr_featuregridpanel',id:'hr-featuregridpanel',header:false,border:false,autoConfig:true,exportFormats:['XLS','WellKnownText'],hropts:{zoomOnRowDoubleClick:true,zoomOnFeatureSelect:false,zoomLevelPointSelect:8,zoomToDataExtent:false}}},{searchPanel:{xtype:'hr_gxpquerypanel',name:__('Build your own searches'),description:'This search uses both search within Map extent and/or your own attribute criteria',header:false,border:false,caseInsensitiveMatch:true,autoWildCardAttach:true},resultPanel:{xtype:'hr_featuregridpanel',id:'hr-featuregridpanel',header:false,border:false,autoConfig:true,exportFormats:['XLS','WellKnownText'],hropts:{zoomOnRowDoubleClick:true,zoomOnFeatureSelect:false,zoomLevelPointSelect:8,zoomToDataExtent:true}}}]};Ext.namespace("Heron.options.map");Heron.options.map.settings={projection:"EPSG:900913",units:'dd',maxExtent:new OpenLayers.Bounds(2563208.7,-490420.0,5865288.3,607827.2),center:new OpenLayers.LonLat(37.857239,0.527336).transform(new OpenLayers.Projection("EPSG:4326"),new OpenLayers.Projection("EPSG:900913")),maxResolution:'auto',xy_precision:3,max_features:10,zoom:6,theme:null,permalinks:{paramPrefix:'map',encodeType:false,prettyLayerNames:true},};Ext.namespace("Heron.options.wfs");Heron.options.wfs.downloadFormats=[{name:'CSV',outputFormat:'csv',fileExt:'.csv'},{name:'GML (version 2.1.2)',outputFormat:'text/xml; subtype=gml/2.1.2',fileExt:'.gml'},{name:'ESRI Shapefile (zipped)',outputFormat:'SHAPE-ZIP',fileExt:'.zip'},{name:'GeoJSON',outputFormat:'json',fileExt:'.json'}];Heron.options.map.layers=[new OpenLayers.Layer.Google("Google Terrain",{type:google.maps.MapTypeId.TERRAIN,'sphericalMercator':true,isBaseLayer:true,attribution:"<a href='http://upande.com'>powered by Upande</a>",transitionEffect:'resize'}),new OpenLayers.Layer.Google("Google Streets",{'sphericalMercator':true,isBaseLayer:true,attribution:"<a href='http://upande.com'>powered by Upande</a>",transitionEffect:'resize',visibility:false,}),new OpenLayers.Layer.Google("Google Hybrid",{type:google.maps.MapTypeId.HYBRID,'sphericalMercator':true,isBaseLayer:true,attribution:"<a href='http://upande.com'>powered by Upande</a>",transitionEffect:'resize',visibility:false}),new OpenLayers.Layer.Google("Google Satellite",{type:google.maps.MapTypeId.SATELLITE,'sphericalMercator':true,isBaseLayer:true,attribution:"<a href='http://upande.com'>powered by Upande</a>",transitionEffect:'resize',visibility:false,}),new OpenLayers.Layer.WMS("County","http://204.236.224.228:8080/geoserver/wms",{layers:"geonode:majidata_counties",transparent:true,format:'image/png'},{singleTile:false,opacity:0.65,isBaseLayer:false,visibility:true,noLegend:false,featureInfoFormat:'application/vnd.ogc.gml',transitionEffect:'none',metadata:{wfs:{protocol:'fromWMSLayer',downloadFormats:Heron.options.wfs.downloadFormats}}}),new OpenLayers.Layer.WMS("Town","http://204.236.224.228:8080/geoserver/wms",{layers:"geonode:majidata_towns",transparent:true,format:'image/png'},{singleTile:false,opacity:0.65,isBaseLayer:false,visibility:true,noLegend:false,featureInfoFormat:'application/vnd.ogc.gml',transitionEffect:'none',metadata:{wfs:{protocol:'fromWMSLayer',downloadFormats:Heron.options.wfs.downloadFormats}}}),new OpenLayers.Layer.WMS("Slum","http://204.236.224.228:8080/geoserver/wms",{layers:"geonode:majidata_slums",transparent:true,format:'image/png'},{singleTile:false,opacity:0.65,isBaseLayer:false,visibility:true,noLegend:false,featureInfoFormat:'application/vnd.ogc.gml',transitionEffect:'none',metadata:{wfs:{protocol:'fromWMSLayer',downloadFormats:Heron.options.wfs.downloadFormats}}}),new OpenLayers.Layer.WMS("Area","http://204.236.224.228:8080/geoserver/wms",{layers:"geonode:majidata_areas",transparent:true,format:'image/png'},{singleTile:false,opacity:0.65,isBaseLayer:false,visibility:true,noLegend:false,featureInfoFormat:'application/vnd.ogc.gml',transitionEffect:'none',metadata:{wfs:{protocol:'fromWMSLayer',downloadFormats:Heron.options.wfs.downloadFormats}}}),new OpenLayers.Layer.WMS("WSP","http://204.236.224.228:8080/geoserver/wms",{layers:"geonode:majidata_wsp",transparent:true,format:'image/png'},{singleTile:false,opacity:0.65,isBaseLayer:false,visibility:true,noLegend:false,featureInfoFormat:'application/vnd.ogc.gml',transitionEffect:'none',metadata:{wfs:{protocol:'fromWMSLayer',downloadFormats:Heron.options.wfs.downloadFormats}}}),];Heron.options.map.toolbar=[{type:"scale",options:{width:110}},{type:"-"},{type:"featureinfo",options:{pressed:true,}},{type:"-"},{type:"pan"},{type:"zoomin"},{type:"zoomout"},{type:"zoomvisible"},{type:"-"},{type:"zoomprevious"},{type:"zoomnext"},{type:"-"},{type:"measurelength",options:{geodesic:true}},{type:"measurearea",options:{geodesic:true}},{type:"-"},{type:"searchcenter",options:{tooltip:'Advanced Search',searchWindow:{title:__('Advanced Search'),x:100,y:undefined,width:360,height:440,collapsible:true,items:[Heron.examples.searchPanelConfig]}}},{type:"-"},{type:"namesearch",options:{xtype:"gx_geocodercombo",id:"cmb_wsp",tooltip:'Find all available WSPs',width:120,listWidth:250,hideTrigger:false,srs:"EPSG:900913",emptyText:'Search for a WSP',queryParam:"CQL_FILTER",store:new Ext.data.Store({reader:new GeoExt.data.FeatureReader({},[{name:'name',mapping:'WSPName'},{name:'bounds',convert:function(v,feature){return feature.geometry.getBounds().toArray();}}]),proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.Script({url:"http://204.236.224.228:8080/geoserver/wfs",callbackKey:"format_options",callbackPrefix:"callback:",params:{service:"WFS",version:"1.1.0",srsName:"EPSG:900913",request:"GetFeature",typeName:"geonode:majidata_wsp",outputFormat:"json"}})})}),listeners:{beforequery:function(qe){qe.query="WSPName like '%"+qe.query+"%'";}}}},{type:"-"},{type:"namesearch",options:{xtype:"gx_geocodercombo",id:"cmb_county",tooltip:'Find all available Conties',width:130,listWidth:200,hideTrigger:false,srs:"EPSG:900913",emptyText:'Search for a County',queryParam:"CQL_FILTER",store:new Ext.data.Store({reader:new GeoExt.data.FeatureReader({},[{name:'name',mapping:'CountyName'},{name:'bounds',convert:function(v,feature){return feature.geometry.getBounds().toArray();}}]),proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.Script({url:"http://204.236.224.228:8080/geoserver/wfs",callbackKey:"format_options",callbackPrefix:"callback:",params:{service:"WFS",version:"1.1.0",srsName:"EPSG:900913",request:"GetFeature",typeName:"geonode:majidata_counties",outputFormat:"json"}})})}),listeners:{beforequery:function(qe){qe.query="CountyName like '%"+qe.query+"%'";}}}},{type:"-"},{type:"any",options:{xtype:"gx_geocodercombo",id:"cmb_town",tooltip:'Find all available Towns',width:130,listWidth:200,hideTrigger:false,srs:"EPSG:900913",emptyText:'Search for an Town',queryParam:"CQL_FILTER",store:new Ext.data.Store({reader:new GeoExt.data.FeatureReader({},[{name:'name',mapping:'TownName'},{name:'bounds',convert:function(v,feature){return feature.geometry.getBounds().toArray();}}]),proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.Script({url:"http://204.236.224.228:8080/geoserver/wfs",callbackKey:"format_options",callbackPrefix:"callback:",params:{service:"WFS",version:"1.1.0",srsName:"EPSG:900913",request:"GetFeature",typeName:"geonode:majidata_towns",outputFormat:"json"}})})}),listeners:{beforequery:function(qe){qe.query="TownName like '%"+qe.query+"%'";}}}},{type:"-"},{type:"namesearch",options:{xtype:"gx_geocodercombo",id:"cmb_slums",tooltip:'Find all available Slums',width:120,listWidth:200,queryMode:'local',hideTrigger:false,srs:"EPSG:900913",emptyText:'Search for Slum',queryParam:"CQL_FILTER",store:new Ext.data.Store({reader:new GeoExt.data.FeatureReader({},[{name:'name',mapping:'Slumname'},{name:'bounds',convert:function(v,feature){return feature.geometry.getBounds().toArray();}}]),proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.Script({url:"http://204.236.224.228:8080/geoserver/wfs",callbackKey:"format_options",callbackPrefix:"callback:",params:{service:"WFS",version:"1.1.0",srsName:"EPSG:900913",request:"GetFeature",typeName:"geonode:majidata_slums",outputFormat:"json"}})})}),listeners:{beforequery:function(qe){qe.query="Slumname like '%"+qe.query+"%'";}}}},{type:"-"},{type:"namesearch",options:{xtype:"gx_geocodercombo",id:"cmb_areas",tooltip:'Find all available Areas',width:130,listWidth:200,hideTrigger:false,srs:"EPSG:900913",emptyText:'Search for an Area',queryParam:"CQL_FILTER",store:new Ext.data.Store({reader:new GeoExt.data.FeatureReader({},[{name:'name',mapping:'Areaname'},{name:'bounds',convert:function(v,feature){return feature.geometry.getBounds().toArray();}}]),proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.Script({url:"http://204.236.224.228:8080/geoserver/wfs",callbackKey:"format_options",callbackPrefix:"callback:",params:{service:"WFS",version:"1.1.0",srsName:"EPSG:900913",request:"GetFeature",typeName:"geonode:majidata_areas",outputFormat:"json"}})})}),listeners:{beforequery:function(qe){qe.query="Areaname like '%"+qe.query+"%'";},select:function(combo,record,index){}}}},{type:"-"},];function highlightWMS(layer,attrib,unitid){clearLayers();var sld='';sld+='<sld:StyledLayerDescriptor xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd" xmlns:sld="http://www.opengis.net/sld" xmlns:ogc="http://www.opengis.net/ogc" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="1.0.0">';sld+='<NamedLayer><Name>'+layer+'</Name><UserStyle><Title>Default Style</Title><FeatureTypeStyle>';sld+='<Rule><ogc:Filter>';sld+='<ogc:PropertyIsEqualTo><ogc:PropertyName>';sld+=attrib;sld+='</ogc:PropertyName><ogc:Literal>';sld+=unitid;sld+='</ogc:Literal></ogc:PropertyIsEqualTo>';sld+='</ogc:Filter>';sld+='<LineSymbolizer><Stroke><CssParameter name="stroke">#00fd00</CssParameter></Stroke></LineSymbolizer>';sld+='<PolygonSymbolizer><Fill><CssParameter name="fill">#cccccc</CssParameter><CssParameter name="fill-opacity">0.65</CssParameter></Fill></PolygonSymbolizer>';sld+='</Rule></FeatureTypeStyle></UserStyle></NamedLayer></sld:StyledLayerDescriptor>';var wmslayer=new OpenLayers.Layer.WMS("Selected","http://204.236.224.228:8080/geoserver/wms",{layers:layer,format:'image/png',sld_body:sld,transparent:true,isBaseLayer:false,displayInLayerSwitcher:false,singleTile:true});mapPanel.map.addLayer(wmslayer);}
Ext.namespace("Heron");Heron.layout={xtype:'panel',id:'hr-container-main',layout:'border',renderTo:'map',split:false,border:false,height:mapH,items:[{xtype:'panel',id:'Maps',title:'Map',layout:'border',region:'center',width:'100%',collapsible:false,split:false,border:false,items:[{xtype:'panel',id:'hr-menu-left-container',title:'Layers',layout:'auto',region:"west",width:240,collapsible:true,collapsed:true,split:true,border:false,items:[{xtype:'hr_layertreepanel',title:'Visible Layers',height:220,hropts:Heron.options.layertree,},{xtype:'panel',title:'Indicators',height:200,items:[indicator_style_form],}]},{xtype:'panel',id:'hr-map-featureinfo-container',layout:'border',region:'center',width:'100%',collapsible:false,split:false,border:false,items:[{xtype:'hr_mappanel',id:'hr-map',region:'center',collapsible:false,border:false,hropts:Heron.options.map},{xtype:'hr_featureinfopanel',id:'hr-feature-info',region:"south",border:true,collapsible:true,collapsed:true,height:205,split:false,showTopToolbar:true,exportFormats:['CSV','XLS','GMLv2'],displayPanels:['Grid','XML'],infoFormat:'application/vnd.ogc.gml',discardStylesForDups:true,maxFeatures:10}]},{xtype:'panel',id:'hr-menu-right-container',title:'Legend',layout:'fit',region:"east",width:240,collapsible:true,split:false,border:false,items:[{xtype:'hr_layerlegendpanel',id:'hr-layerlegend-panel',title:'',defaults:{useScaleParameter:true,baseParams:{FORMAT:'image/png'}},hropts:{prefetchLegends:false}}]}]},]};